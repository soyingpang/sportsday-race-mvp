<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>徑賽系統（MVP）</title>
  <link rel="stylesheet" href="./assets/app.css" />
</head>
<body>
  <header class="bar">
    <div class="title">徑賽系統（MVP / 4 道）</div>
    <nav class="nav">
      <a href="./board.html" target="_blank" rel="noopener">大螢幕看板</a>
      <a href="./score.html" target="_blank" rel="noopener">計分員輸入</a>
      <button id="btnReset" class="danger">重置本機資料</button>
    </nav>
  </header>
  <div id="diag" class="msg" style="padding:0 16px"></div>

  <main class="grid">
    <section class="card">
      <h2>1) 匯入參賽名單（CSV）</h2>
      <p class="muted">欄位：id,class,no,name,present（present 允許 true/false 或 1/0）</p>
      <div class="row">
        <input type="file" id="fileCsv" accept=".csv,text/csv" />
        <button id="btnLoadSample">載入範例名單</button>
      </div>
      <div id="importMsg" class="msg"></div>

      <details>
        <summary>名單概覽</summary>
        <div id="participantsSummary" class="mono" style="margin-top:8px"></div>
      </details>
    </section>

    <section class="card">
      <h2>2) 建立賽程（同年級、兩班對賽）</h2>
      <p class="muted">規則：每組 A 班 2 人 + B 班 2 人，Lane1→4 順序分線（A1,A2,B1,B2）。</p>

      <div class="row">
        <label>年級
          <select id="selGrade">
            <option value="1">一年級</option>
            <option value="2">二年級</option>
          </select>
        </label>
        <label>項目 <input id="inpEvent" value="60m" /></label>
        <label>輪次
          <select id="selRound">
            <option value="預賽">預賽</option>
            <option value="決賽">決賽</option>
          </select>
        </label>
        <label>起始組次 <input id="inpHeatNo" type="number" min="1" value="1" /></label>
      </div>

      <div class="row">
        <label>A 班 <select id="selClassA"></select></label>
        <label>B 班 <select id="selClassB"></select></label>

        <label style="display:flex;gap:10px;align-items:center">
          模式
          <span class="muted">
            <label style="margin-right:8px"><input type="radio" name="buildMode" value="single" checked> 建立 1 組</label>
            <label><input type="radio" name="buildMode" value="all"> 自動排完</label>
          </span>
        </label>

        <button id="btnBuildHeats" class="primary">建立/排程</button>
      </div>

      <details>
        <summary>進階（名單挑選 / 補位策略）</summary>

        <div class="row" style="margin-top:10px">
          <label>不足 2 人補位策略
            <select id="selFill">
              <option value="other">由另一班補足（先填滿 Lane）</option>
              <option value="empty">保留空道</option>
            </select>
          </label>
        </div>

        <div class="row">
          <div class="col">
            <h3>A 班選手（最多 2/每組）</h3>
            <div id="pickA" class="picker"></div>
          </div>
          <div class="col">
            <h3>B 班選手（最多 2/每組）</h3>
            <div id="pickB" class="picker"></div>
          </div>
        </div>

        <p class="muted" style="margin-top:8px">
          提示：按「取前2位」可快速勾選；選取超過 2 位時，「自動排完」會依座號順序每 2 位切一組。
        </p>
      </details>

      <div id="createMsg" class="msg"></div>
    </section>

    <section class="card span2">
      <h2>3) 組次清單與匯出</h2>

      <div class="row">
        <button id="btnExportHeatsOneSheet" class="primary">匯出：場次手寫計分表（Excel / 單一工作表）</button>
        <span id="exportMsg" class="muted"></span>
      </div>

      <div id="heatsOverview"></div>
      <div id="heatsList"></div>

      <details>
        <summary>其他表單（非徑賽核心）</summary>
        <p class="muted">用途：列印後手寫填入三個類別分數（不會拆成多個 Sheet）。</p>
        <div class="row">
          <label>類別1 <input id="cat1" value="類別1" /></label>
          <label>類別2 <input id="cat2" value="類別2" /></label>
          <label>類別3 <input id="cat3" value="類別3" /></label>
          <button id="btnExportTotal">匯出：總分表（Excel）</button>
        </div>
      </details>
    </section>
  </main>

  <footer class="foot muted">
    <div>資料儲存在此瀏覽器 localStorage；多分頁以 BroadcastChannel 同步。</div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
  <script type="module" src="./assets/app.js"></script>
</body>
</html>
