<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>親子遊戲日 計分系統</title>
  <link rel="stylesheet" href="./assets/app.css" />
</head>
<body>
  <header class="bar">
    <div class="title">親子遊戲日 計分系統（4 道）</div>
    <nav class="nav">
      <a href="./board.html" target="_blank" rel="noopener">大螢幕看板</a>
      <a href="./score.html" target="_blank" rel="noopener">iPad 計分</a>
      <a href="./admin.html" target="_blank" rel="noopener">後台總控入分</a>
      <button id="btnReset" class="danger">重置本機資料</button>
    </nav>
  </header>
  <div id="diag" class="msg" style="padding:0 16px"></div>

  
  <main class="grid">

    <section class="card">
      <h2>參賽名單（已鎖定）</h2>
      <p class="muted">本次活動使用既定範例名單（data/participants.sample.csv）。如需更換，請展開「進階」。</p>
      <details>
        <summary>進階：重新匯入名單 CSV</summary>
        <div class="row">
          <input id="fileCsv" type="file" accept=".csv,text/csv" />
          <button id="btnLoadSample">載入既定名單</button>
        </div>
        <div id="importMsg" class="muted"></div>
      </details>
      <div id="participantsSummary" class="muted"></div>
    </section>

    <section class="card">
      <h2>建立賽程（4 道）</h2>
      <div class="row">
        <label>項目</label>
        <select id="inpEvent">
          <option value="火炬接力跑">火炬接力跑</option>
          <option value="豆袋運送">豆袋運送</option>
          <option value="穿越時光隧道">穿越時光隧道</option>
        </select>
        <label>組次</label>
        <input id="inpHeatNo" type="number" min="1" step="1" value="1" style="width:90px" />
      </div>

      <details>
        <summary>進階：指定 A/B 班與選手（可略過）</summary>
        <div class="row">
          <label>年級</label>
          <select id="selGrade"></select>
          <label>A 班</label>
          <select id="selClassA"></select>
          <label>B 班</label>
          <select id="selClassB"></select>
          <label>補位</label>
          <select id="selFill">
            <option value="other">不足用另一班補足</option>
            <option value="empty">不足留空</option>
          </select>
        </div>
        <div class="row">
          <div style="flex:1">
            <div class="muted">A 班（取前 2 位）</div>
            <div id="pickA" class="pick"></div>
          </div>
          <div style="flex:1">
            <div class="muted">B 班（取前 2 位）</div>
            <div id="pickB" class="pick"></div>
          </div>
        </div>
      </details>

      <div class="row">
        <div class="muted">模式：</div>
        <label><input type="radio" name="buildMode" value="single" checked> 建立 1 組</label>
        <label><input type="radio" name="buildMode" value="all"> 自動排完（依名單）</label>
        <button id="btnBuildHeats" class="primary">建立/排程</button>
      </div>
      <div id="createMsg" class="muted"></div>
    </section>

    <section class="card">
      <h2>文件匯出（交件用）</h2>
      <div class="row">
        <button id="btnExportBackup">匯出資料備份（JSON）</button>
        <button id="btnExportTotal">匯出總分表（XLSX）</button>
        <button id="btnExportHand">匯出手寫計分表（XLSX）</button>
      </div>
      <details>
        <summary>進階：總分表欄位名稱</summary>
        <div class="row">
          <label>類別1</label><input id="cat1" value="類別1" />
          <label>類別2</label><input id="cat2" value="類別2" />
          <label>類別3</label><input id="cat3" value="類別3" />
        </div>
      </details>
      <div class="muted">提示：手寫計分表會依目前已建立的組次產生，每組 4 道一列。</div>
    </section>

    <section class="card">
      <h2>組次列表</h2>
      <div id="heatsOverview"></div>
      <div id="heatsList"></div>
    </section>

  </main>


  <footer class="foot muted">
    <div>資料儲存在此瀏覽器 localStorage；多分頁以 BroadcastChannel 同步。</div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
  <script type="module" src="./assets/app.js"></script>
</body>
</html>
